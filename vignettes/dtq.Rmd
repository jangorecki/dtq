---
title: "data.table query"
date: "`r Sys.Date()`"
output:
  rmarkdown::html_document
vignette: >
  %\VignetteIndexEntry{dtq}
  %\VignetteEngine{knitr::rmarkdown}
  %\usepackage[utf8]{inputenc}
---

Package provides mainly the auditing feature for data.table queries.  
All the data.table queries are logged in R session memory.  

```{r, echo = FALSE, message = FALSE}
knitr::opts_chunk$set(
  comment = "#",
  error = FALSE,
  tidy = FALSE,
  cache = FALSE,
  collapse = TRUE)
```

## Log query details

```{r dtl, message=FALSE}
library(dtq)
DT <- data.table(a=rep(1:4), b=rep(letters[1:2],2))

# make some data.table queries
DT[a < 100L, .(a,b)
   ][i = b %in% c(letters[1:2]), mean_a_by_b := mean(a), b
     ][, c("a5","ab5") := lapply(.SD, `+`, 5L), .SDcols = -c("b")
       ][]
DT[, by = .(b), lapply(.SD,sum), .SDcols=c("a")
   ][b %in% c("a","b"), mean(a)]

# print queries log
dt <- dtl()
knitr::kable(subset(dt, select = -dtq))
dt <- dtl(chain=TRUE)
knitr::kable(dt)
```

## Set data.table read-only

```{r read_only}
dtl(purge=TRUE)

DT <- data.table(a = 1L)
DT[, a := 2L]
print(DT)
  
DT <- data.table(a = 1L)
setattr(DT,"read.only",TRUE)
DT[, a := 2L]
print(DT)

knitr::kable(subset(dtl(), select = -dtq))
```
